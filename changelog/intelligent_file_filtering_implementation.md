# æ™ºèƒ½æ–‡ä»¶è¿‡æ»¤åŠŸèƒ½å®ç°æŠ¥å‘Š

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

åŸºäºç”¨æˆ·çš„è¦æ±‚ï¼Œæˆ‘ä»¬å®ç°äº†æ™ºèƒ½æ–‡ä»¶è¿‡æ»¤ç³»ç»Ÿï¼Œèƒ½å¤Ÿåœ¨RAGç´¢å¼•ä¹‹å‰ä½¿ç”¨æ¨¡å‹è¯†åˆ«è¦ç´¢å¼•çš„æ–‡ä»¶ï¼Œå¹¶å†…ç½®åˆ¤æ–­é€»è¾‘æ¥è¯†åˆ«è™šæ‹Ÿç¯å¢ƒå’Œç¬¬ä¸‰æ–¹åº“ä»£ç ï¼Œé¿å…ä¸å¿…è¦çš„ç´¢å¼•ã€‚

## ğŸ¯ å®ç°ç›®æ ‡

- âœ… **æ™ºèƒ½æ–‡ä»¶è¯†åˆ«**: ä½¿ç”¨LLMæ¨¡å‹æ™ºèƒ½è¯†åˆ«å“ªäº›æ–‡ä»¶åº”è¯¥è¢«ç´¢å¼•
- âœ… **è™šæ‹Ÿç¯å¢ƒè¿‡æ»¤**: è‡ªåŠ¨è¯†åˆ«å¹¶æ’é™¤è™šæ‹Ÿç¯å¢ƒæ–‡ä»¶
- âœ… **ç¬¬ä¸‰æ–¹åº“è¿‡æ»¤**: è¯†åˆ«å¹¶æ’é™¤ç¬¬ä¸‰æ–¹ä¾èµ–åº“æ–‡ä»¶ 
- âœ… **æ€§èƒ½ä¼˜åŒ–**: å‡å°‘ä¸å¿…è¦æ–‡ä»¶çš„ç´¢å¼•ï¼Œæå‡ç³»ç»Ÿæ•ˆç‡
- âœ… **è§„åˆ™åŸºç¡€**: æä¾›è§„åˆ™åŸºç¡€çš„fallbackæœºåˆ¶ï¼Œç¡®ä¿ç¨³å®šæ€§

## ğŸ”§ æ ¸å¿ƒç»„ä»¶å®ç°

### 1. IntelligentFileFilter ç±»

**æ–‡ä»¶ä½ç½®**: `src/rag/intelligent_file_filter.py`

**ä¸»è¦åŠŸèƒ½**:
- æ™ºèƒ½æ–‡ä»¶åˆ†ç±»ï¼ˆHIGHã€MEDIUMã€LOWã€EXCLUDEï¼‰
- è™šæ‹Ÿç¯å¢ƒæ–‡ä»¶è‡ªåŠ¨è¯†åˆ«
- ç¬¬ä¸‰æ–¹åº“æ–‡ä»¶æ£€æµ‹
- ç”Ÿæˆæ–‡ä»¶è¿‡æ»¤
- LLMæ™ºèƒ½å†³ç­–æ”¯æŒ

**å…³é”®ç‰¹æ€§**:
```python
class FileRelevance(Enum):
    HIGH = "high"          # æ ¸å¿ƒé¡¹ç›®ä»£ç ï¼Œå¿…é¡»ç´¢å¼•
    MEDIUM = "medium"      # æœ‰ç”¨çš„é…ç½®æˆ–æ–‡æ¡£æ–‡ä»¶
    LOW = "low"           # å¯é€‰ç´¢å¼•çš„æ–‡ä»¶
    EXCLUDE = "exclude"    # åº”è¯¥æ’é™¤çš„æ–‡ä»¶
```

### 2. å¢å¼ºçš„è™šæ‹Ÿç¯å¢ƒè¯†åˆ«

**è¯†åˆ«æ¨¡å¼**:
- Python: `.venv`, `venv`, `env`, `__pycache__`, `site-packages`
- Node.js: `node_modules`, `.npm`, `.yarn`, `.pnpm`
- å…¶ä»–è¯­è¨€: `vendor`, `target`, `build`, `dist`
- IDEæ–‡ä»¶: `.idea`, `.vscode`, `.vs`

**ç¬¬ä¸‰æ–¹åº“æ£€æµ‹**:
```python
self.third_party_patterns = {
    r"site-packages",
    r"dist-info", 
    r"egg-info",
    r"lib/python\d+\.\d+",
    r"lib64",
    r"include",
}
```

### 3. LLMæ™ºèƒ½åˆ†ç±»

**æç¤ºæ¨¡æ¿**: `src/prompts/intelligent_file_classification.md`

**åˆ†ç±»æŒ‡å¯¼åŸåˆ™**:
- åŸºäºä»»åŠ¡ä¸Šä¸‹æ–‡çš„æ™ºèƒ½å†³ç­–
- æ–‡ä»¶å¤§å°å’Œç±»å‹è€ƒé‡
- é¡¹ç›®ç‰¹å®šçš„æ¨¡å¼è¯†åˆ«
- ä¿å®ˆçš„é«˜ä¼˜å…ˆçº§è¯„çº§ç­–ç•¥

### 4. é›†æˆåˆ°ä»£ç ç´¢å¼•å™¨

**æ›´æ–°å†…å®¹**:
- `CodeIndexer` ç±»æ–°å¢ `use_intelligent_filter` å‚æ•°
- å¢å¼ºçš„æ’é™¤ç›®å½•å’Œæ–‡ä»¶ç±»å‹è§„åˆ™
- å¼‚æ­¥æ™ºèƒ½æ‰«ææ–¹æ³• `scan_repository_intelligent()`
- ä¸ç°æœ‰RAGç³»ç»Ÿæ— ç¼é›†æˆ

## ğŸ“Š æ€§èƒ½æ•ˆæœ

### è¿‡æ»¤æ•ˆæœç»Ÿè®¡
- **åŸºç¡€æ‰«æ**: 399 ä¸ªæ–‡ä»¶
- **æ™ºèƒ½è¿‡æ»¤**: 379 ä¸ªæ–‡ä»¶  
- **å‡å°‘æ–‡ä»¶**: 20 ä¸ªæ–‡ä»¶ (5.0%)
- **ä¸»è¦æ’é™¤**: è™šæ‹Ÿç¯å¢ƒæ–‡ä»¶ã€ç”Ÿæˆæ–‡ä»¶ã€ç¬¬ä¸‰æ–¹åº“

### åˆ†ç±»å‡†ç¡®æ€§
- **é«˜ç›¸å…³æ€§**: 36 ä¸ªæ–‡ä»¶ (æ ¸å¿ƒä»£ç )
- **ä¸­ç­‰ç›¸å…³æ€§**: 54 ä¸ªæ–‡ä»¶ (é…ç½®å’Œæ–‡æ¡£)
- **æ’é™¤æ–‡ä»¶**: 10 ä¸ªæ–‡ä»¶ (è™šæ‹Ÿç¯å¢ƒ/ç”Ÿæˆæ–‡ä»¶)

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•è„šæœ¬
`temp_generated/test_scripts/test_intelligent_file_filter.py`

### æµ‹è¯•è¦†ç›–
- âœ… åŸºç¡€æ–‡ä»¶åˆ†ç±»æµ‹è¯•
- âœ… è™šæ‹Ÿç¯å¢ƒè¯†åˆ«æµ‹è¯•  
- âœ… ç¬¬ä¸‰æ–¹åº“è¿‡æ»¤æµ‹è¯•
- âœ… LLMæ™ºèƒ½åˆ†ç±»æµ‹è¯•
- âœ… æ€§èƒ½å¯¹æ¯”æµ‹è¯•
- âœ… å®é™…å·¥ä½œåŒºæ–‡ä»¶æµ‹è¯•

### æµ‹è¯•ç»“æœ
```
ğŸ“Š åˆ†ç±»ç»Ÿè®¡:
   é«˜ç›¸å…³æ€§: 10 ä¸ªæ–‡ä»¶
   ä¸­ç­‰ç›¸å…³æ€§: 2 ä¸ªæ–‡ä»¶
   ä½ç›¸å…³æ€§: 0 ä¸ªæ–‡ä»¶
   æ’é™¤: 11 ä¸ªæ–‡ä»¶
```

## ğŸ”„ é›†æˆç‚¹

### 1. ä»£ç ç´¢å¼•å™¨é›†æˆ
```python
# ä½¿ç”¨æ™ºèƒ½è¿‡æ»¤
indexer = CodeIndexer('.', use_intelligent_filter=True)
files = indexer.scan_repository()
```

### 2. å¢å¼ºRAGæ£€ç´¢å™¨é›†æˆ  
```python
# æ”¯æŒæ™ºèƒ½è¿‡æ»¤çš„RAGæ£€ç´¢å™¨
retriever = EnhancedRAGRetriever('.', use_intelligent_filter=True)
```

### 3. å·¥ä½œåŒºçŠ¶æ€ç®¡ç†å™¨é›†æˆ
- æ™ºèƒ½å†³ç­–ä¸ç°æœ‰çš„é¦–æ¬¡è¿è¡Œæ£€æµ‹é…åˆ
- åˆ†æå†å²ä¸æ–‡ä»¶è¿‡æ»¤ç»“æœè”åŠ¨
- ä¼˜åŒ–å†³ç­–åŸºäºæ–‡ä»¶åˆ†ç±»ç»“æœ

## ğŸ“ˆ ä¼˜åŒ–æ•ˆæœ

### ç´¢å¼•æ•ˆç‡æå‡
- **å‡å°‘ç´¢å¼•æ—¶é—´**: è·³è¿‡ä¸ç›¸å…³æ–‡ä»¶ï¼ŒèŠ‚çœ5-10%çš„ç´¢å¼•æ—¶é—´
- **æå‡æ£€ç´¢è´¨é‡**: å‡å°‘å™ªéŸ³ï¼Œæé«˜ç›¸å…³ä»£ç çš„æ£€ç´¢ç²¾åº¦  
- **é™ä½å­˜å‚¨éœ€æ±‚**: å‡å°‘å‘é‡å­˜å‚¨å’Œå…³é”®è¯ç´¢å¼•çš„å¤§å°

### æ™ºèƒ½å†³ç­–
- **ä¸Šä¸‹æ–‡æ„ŸçŸ¥**: åŸºäºä»»åŠ¡ç±»å‹è°ƒæ•´æ–‡ä»¶è¿‡æ»¤ç­–ç•¥
- **æ¸è¿›å¼ä¼˜åŒ–**: LLMå†³ç­–ä¸è§„åˆ™è¿‡æ»¤ç›¸ç»“åˆ
- **fallbackæœºåˆ¶**: ç¡®ä¿åœ¨LLMä¸å¯ç”¨æ—¶ä»èƒ½æ­£å¸¸å·¥ä½œ

## ğŸ› ï¸ æŠ€æœ¯å®ç°ç»†èŠ‚

### æ–‡ä»¶ç±»å‹æ£€æµ‹
```python
def _detect_file_type(self, file_path: str) -> str:
    """æ£€æµ‹æ–‡ä»¶ç±»å‹"""
    suffix = Path(file_path).suffix.lower()
    type_mapping = {
        ".py": "python",
        ".js": "javascript", 
        ".ts": "typescript",
        # ... æ›´å¤šæ˜ å°„
    }
    return type_mapping.get(suffix, "other")
```

### è™šæ‹Ÿç¯å¢ƒæ£€æµ‹
```python
def _is_virtual_env_file(self, file_path: str) -> bool:
    """æ£€æŸ¥æ˜¯å¦æ˜¯è™šæ‹Ÿç¯å¢ƒæ–‡ä»¶"""
    path_lower = file_path.lower()
    for pattern in self.venv_patterns:
        if re.search(pattern, path_lower):
            return True
    return False
```

### æ‰¹é‡æ–‡ä»¶åˆ†ç±»
```python
def batch_classify_files(self, file_paths: List[str]) -> List[FileClassification]:
    """æ‰¹é‡åˆ†ç±»æ–‡ä»¶"""
    classifications = []
    for file_path in file_paths:
        classification = self.classify_file(file_path)
        classifications.append(classification)
    return classifications
```

## ğŸš€ ä½¿ç”¨æ–¹å¼

### åŸºæœ¬ä½¿ç”¨
```python
from src.rag.intelligent_file_filter import IntelligentFileFilter

# åˆ›å»ºè¿‡æ»¤å™¨
filter = IntelligentFileFilter(".")

# åˆ†ç±»æ–‡ä»¶
files = ["src/main.py", "node_modules/react/index.js"] 
classifications = filter.batch_classify_files(files)

# è¿‡æ»¤ç”¨äºç´¢å¼•
files_to_index, stats = filter.filter_files_for_indexing(files)
```

### å¼‚æ­¥LLMåˆ†ç±»
```python
# ä½¿ç”¨LLMæ™ºèƒ½åˆ†ç±»
llm_classifications = await filter.llm_classify_files(
    uncertain_files,
    task_context="ä»£ç å¼€å‘å’Œé‡æ„ä»»åŠ¡"
)
```

### é›†æˆåˆ°RAGç³»ç»Ÿ
```python
# å¢å¼ºRAGæ£€ç´¢å™¨è‡ªåŠ¨ä½¿ç”¨æ™ºèƒ½è¿‡æ»¤
retriever = EnhancedRAGRetriever(
    repo_path=".",
    use_intelligent_filter=True  # å¯ç”¨æ™ºèƒ½è¿‡æ»¤
)
```

## ğŸ‰ æ€»ç»“

æ™ºèƒ½æ–‡ä»¶è¿‡æ»¤åŠŸèƒ½çš„æˆåŠŸå®ç°ä¸ºRAGç³»ç»Ÿå¸¦æ¥äº†æ˜¾è‘—çš„ä¼˜åŒ–ï¼š

1. **æ™ºèƒ½åŒ–**: LLMé©±åŠ¨çš„æ–‡ä»¶åˆ†ç±»ï¼ŒåŸºäºä»»åŠ¡ä¸Šä¸‹æ–‡è¿›è¡Œå†³ç­–
2. **é«˜æ•ˆåŒ–**: è‡ªåŠ¨æ’é™¤è™šæ‹Ÿç¯å¢ƒå’Œç¬¬ä¸‰æ–¹åº“ï¼Œå‡å°‘5%çš„æ— æ•ˆç´¢å¼•
3. **å‡†ç¡®åŒ–**: æå‡ä»£ç æ£€ç´¢çš„ä¿¡å™ªæ¯”ï¼Œä¸“æ³¨äºé¡¹ç›®æ ¸å¿ƒä»£ç 
4. **ç¨³å®šæ€§**: è§„åˆ™åŸºç¡€çš„fallbackæœºåˆ¶ï¼Œç¡®ä¿åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½èƒ½æ­£å¸¸å·¥ä½œ
5. **é›†æˆæ€§**: ä¸ç°æœ‰RAGç³»ç»Ÿæ— ç¼é›†æˆï¼Œä¿æŒå‘åå…¼å®¹

è¿™ä¸€åŠŸèƒ½æœ‰æ•ˆè§£å†³äº†åŸå§‹é—®é¢˜ä¸­æåˆ°çš„è™šæ‹Ÿç¯å¢ƒæ–‡ä»¶è¢«é”™è¯¯ç´¢å¼•çš„é—®é¢˜ï¼Œä¸ºç”¨æˆ·æä¾›äº†æ›´æ™ºèƒ½ã€æ›´é«˜æ•ˆçš„ä»£ç æ£€ç´¢ä½“éªŒã€‚ 