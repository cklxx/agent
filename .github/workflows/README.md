# GitHub Actionså·¥ä½œæµç¨‹æ–‡æ¡£

æœ¬ç›®å½•åŒ…å«äº†Code Agenté¡¹ç›®çš„æ‰€æœ‰CI/CDå·¥ä½œæµç¨‹é…ç½®ã€‚

## ğŸ“‹ å·¥ä½œæµç¨‹æ¦‚è§ˆ

### 1. ä»£ç è´¨é‡æ£€æŸ¥

#### `lint.yaml` - ä»£ç è§„èŒƒæ£€æŸ¥
- **è§¦å‘**: Pushå’ŒPull Request
- **åŠŸèƒ½**: ä»£ç æ ¼å¼åŒ–å’Œé™æ€åˆ†ææ£€æŸ¥
- **å·¥å…·**: black, flake8, mypyç­‰

#### `unittest.yaml` - å•å…ƒæµ‹è¯•
- **è§¦å‘**: Pushåˆ°mainåˆ†æ”¯ï¼Œæ‰€æœ‰Pull Request
- **åŠŸèƒ½**: è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
- **è¦æ±‚**: æµ‹è¯•è¦†ç›–ç‡ â‰¥ 25%
- **äº§ç‰©**: HTMLè¦†ç›–ç‡æŠ¥å‘Š

### 2. æ„å»ºå’Œå‘å¸ƒ

#### `build-and-release.yaml` - ä¸»è¦æ„å»ºæµç¨‹
- **è§¦å‘**: 
  - Pushåˆ°mainåˆ†æ”¯ (å¼€å‘æ„å»º)
  - ç‰ˆæœ¬æ ‡ç­¾æ¨é€ (æ­£å¼å‘å¸ƒ)
  - Pull Request (æµ‹è¯•æ„å»º)
  - æ‰‹åŠ¨è§¦å‘ (å¯é€‰å‘å¸ƒ)
- **å¹³å°**: Linux x86_64, Windows x86_64, macOS x86_64/ARM64
- **æµç¨‹**: æµ‹è¯• â†’ æ„å»º â†’ éªŒè¯ â†’ æ‰“åŒ… â†’ å‘å¸ƒ

#### `quick-build.yaml` - å¿«é€Ÿå¼€å‘æ„å»º
- **è§¦å‘**: æ‰‹åŠ¨è§¦å‘
- **ç”¨é€”**: å¼€å‘æ—¶å¿«é€Ÿæµ‹è¯•å•ä¸ªå¹³å°æ„å»º
- **é€‰é¡¹**: å¯é€‰æ‹©å¹³å°å’Œè·³è¿‡æµ‹è¯•

## ğŸš€ ä½¿ç”¨æŒ‡å—

### è‡ªåŠ¨è§¦å‘

1. **æ—¥å¸¸å¼€å‘**: 
   ```bash
   git push origin feature-branch  # è§¦å‘æµ‹è¯•
   ```

2. **åˆå¹¶åˆ°main**:
   ```bash
   git checkout main
   git merge feature-branch
   git push origin main  # è§¦å‘å®Œæ•´æ„å»º
   ```

3. **å‘å¸ƒç‰ˆæœ¬**:
   ```bash
   git tag v1.0.0
   git push origin v1.0.0  # è§¦å‘å‘å¸ƒæµç¨‹
   ```

### æ‰‹åŠ¨è§¦å‘

1. **è®¿é—®GitHub Actionsé¡µé¢**
2. **é€‰æ‹©å·¥ä½œæµç¨‹**:
   - `Build and Release`: å®Œæ•´æ„å»ºå’Œå¯é€‰å‘å¸ƒ
   - `Quick Build (Dev)`: å¿«é€Ÿå•å¹³å°æ„å»º
3. **ç‚¹å‡»"Run workflow"å¹¶é…ç½®å‚æ•°**

### ä¸‹è½½æ„å»ºäº§ç‰©

#### å¼€å‘æ„å»º
```bash
# ä½¿ç”¨GitHub CLI
gh run list --workflow="build-and-release.yaml"
gh run download [RUN_ID]

# æˆ–é€šè¿‡ç½‘é¡µç•Œé¢ä¸‹è½½Artifacts
```

#### æ­£å¼å‘å¸ƒ
- ç›´æ¥ä»GitHub Releasesé¡µé¢ä¸‹è½½
- åŒ…å«å®Œæ•´å‘å¸ƒåŒ…å’Œæ ¡éªŒå’Œæ–‡ä»¶

## ğŸ› ï¸ å·¥ä½œæµç¨‹è¯¦è§£

### æ„å»ºé˜¶æ®µ

1. **ç¯å¢ƒå‡†å¤‡**
   - å®‰è£…UVå’ŒPython 3.12
   - å®‰è£…é¡¹ç›®ä¾èµ–å’ŒPyInstaller

2. **è´¨é‡æ£€æŸ¥**
   - è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
   - ç¡®ä¿ä»£ç è´¨é‡è¾¾æ ‡

3. **æ„å»ºæ‰§è¡Œ**
   - ä½¿ç”¨PyInstalleræ‰“åŒ…æˆå•æ–‡ä»¶å¯æ‰§è¡Œç¨‹åº
   - åŒ…å«æ‰€æœ‰å¿…è¦çš„ä¾èµ–å’Œæ•°æ®æ–‡ä»¶

4. **æ„å»ºéªŒè¯**
   - æµ‹è¯•å¯æ‰§è¡Œæ–‡ä»¶åŸºæœ¬åŠŸèƒ½
   - éªŒè¯å¸®åŠ©å‘½ä»¤å’ŒåŸºæœ¬é€‰é¡¹

5. **äº§ç‰©æ‰“åŒ…**
   - åˆ›å»ºåŒ…å«æ–‡æ¡£çš„å®Œæ•´å‘å¸ƒåŒ…
   - ç”Ÿæˆå‹ç¼©æ–‡ä»¶ (.tar.gz/.zip)

### å‘å¸ƒé˜¶æ®µ

1. **ç‰ˆæœ¬æ£€æµ‹**
   - æ£€æŸ¥æ˜¯å¦ä¸ºç‰ˆæœ¬æ ‡ç­¾
   - ç”Ÿæˆç‰ˆæœ¬å·å’Œå‘å¸ƒåç§°

2. **èµ„äº§å‡†å¤‡**
   - æ”¶é›†æ‰€æœ‰å¹³å°çš„æ„å»ºäº§ç‰©
   - ç”ŸæˆSHA256æ ¡éªŒå’Œæ–‡ä»¶

3. **åˆ›å»ºå‘å¸ƒ**
   - è‡ªåŠ¨ç”Ÿæˆå‘å¸ƒè¯´æ˜
   - ä¸Šä¼ æ‰€æœ‰å¹³å°çš„å®‰è£…åŒ…
   - æ ‡è®°æ­£å¼ç‰ˆæœ¬æˆ–é¢„å‘å¸ƒ

## ğŸ“Š æ„å»ºçŸ©é˜µ

| å¹³å° | ç³»ç»Ÿç‰ˆæœ¬ | æ¶æ„ | è¾“å‡ºæ–‡ä»¶ |
|------|----------|------|----------|
| Linux | ubuntu-latest | x86_64 | code_agent-linux-x86_64.tar.gz |
| Windows | windows-latest | x86_64 | code_agent-windows-x86_64.zip |
| macOS Intel | macos-latest | x86_64 | code_agent-macos-x86_64.tar.gz |
| macOS Apple Silicon | macos-14 | arm64 | code_agent-macos-arm64.tar.gz |

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡
```yaml
env:
  PYTHON_VERSION: "3.12"     # Pythonç‰ˆæœ¬
  TAVILY_API_KEY: "mock-key" # æµ‹è¯•ç”¨APIå¯†é’¥
```

### å…³é”®æ­¥éª¤

#### ä¾èµ–å®‰è£…
```yaml
- name: Install dependencies
  run: |
    uv venv --python ${{ env.PYTHON_VERSION }}
    uv pip install -e ".[dev]"
    uv add --dev pyinstaller
```

#### æ„å»ºå‘½ä»¤
```yaml
- name: Build executable
  run: |
    uv run python packaging/build.py
```

#### äº§ç‰©ä¸Šä¼ 
```yaml
- name: Upload build artifacts
  uses: actions/upload-artifact@v4
  with:
    name: ${{ steps.package_name.outputs.package_name }}
    path: dist/${{ steps.package_name.outputs.package_name }}.*
    retention-days: 30
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æµ‹è¯•å¤±è´¥**
   - æ£€æŸ¥ä»£ç æ›´æ”¹æ˜¯å¦ç ´åç°æœ‰åŠŸèƒ½
   - æŸ¥çœ‹æµ‹è¯•æ—¥å¿—ç¡®å®šå¤±è´¥åŸå› 
   - æœ¬åœ°è¿è¡Œ `make test` å¤ç°é—®é¢˜

2. **æ„å»ºå¤±è´¥**
   - æ£€æŸ¥ä¾èµ–æ˜¯å¦æ­£ç¡®å®‰è£…
   - æŸ¥çœ‹PyInstallerçš„éšè—å¯¼å…¥è­¦å‘Š
   - ç¡®ä¿ `packaging/build.py` é…ç½®æ­£ç¡®

3. **å‘å¸ƒå¤±è´¥**
   - æ£€æŸ¥ç‰ˆæœ¬æ ‡ç­¾æ ¼å¼ (å¿…é¡»æ˜¯ v*.*)
   - ç¡®ä¿æ‰€æœ‰å¹³å°æ„å»ºæˆåŠŸ
   - æ£€æŸ¥GitHub tokenæƒé™

### è°ƒè¯•æŠ€å·§

1. **æœ¬åœ°å¤ç°**
   ```bash
   # å¤ç°æ„å»ºç¯å¢ƒ
   uv sync
   uv add --dev pyinstaller
   uv run python packaging/test_build.py
   uv run python packaging/build.py
   ```

2. **æŸ¥çœ‹è¯¦ç»†æ—¥å¿—**
   - åœ¨GitHub Actionsé¡µé¢å±•å¼€å¤±è´¥çš„æ­¥éª¤
   - æŸ¥çœ‹å®Œæ•´çš„é”™è¯¯è¾“å‡ºå’Œå †æ ˆè·Ÿè¸ª

3. **ä½¿ç”¨actæœ¬åœ°æµ‹è¯•**
   ```bash
   # å®‰è£…actå¹¶æµ‹è¯•å·¥ä½œæµç¨‹
   brew install act
   act -j build --platform ubuntu-latest=node:16-buster-slim
   ```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### ç¼“å­˜ç­–ç•¥
- UVä¾èµ–ç¼“å­˜: åŠ é€Ÿä¾èµ–å®‰è£…
- PyInstallerç¼“å­˜: åŠ é€Ÿé‡å¤æ„å»º
- æ„å»ºäº§ç‰©ç¼“å­˜: å‡å°‘é‡å¤å·¥ä½œ

### å¹¶è¡Œæ„å»º
- å¤šå¹³å°å¹¶è¡Œæ„å»º
- æµ‹è¯•å’Œæ„å»ºåˆ†ç¦»
- å¤±è´¥å¿«é€Ÿé€€å‡º (fail-fast: false)

### èµ„æºç®¡ç†
- åˆç†çš„artifactä¿ç•™æœŸ
- æŒ‰éœ€ä¸‹è½½æ„å»ºäº§ç‰©
- æ¸…ç†ä¸´æ—¶æ–‡ä»¶

## ğŸ”„ ç»´æŠ¤å»ºè®®

1. **å®šæœŸæ›´æ–°**
   - æ›´æ–°GitHub Actionsç‰ˆæœ¬
   - æ›´æ–°Pythonå’Œä¾èµ–ç‰ˆæœ¬
   - æ£€æŸ¥å®‰å…¨æ¼æ´å’Œä¿®å¤

2. **ç›‘æ§æ„å»ºæ—¶é—´**
   - è·Ÿè¸ªæ„å»ºæ€§èƒ½
   - ä¼˜åŒ–æ…¢æ­¥éª¤
   - è°ƒæ•´ç¼“å­˜ç­–ç•¥

3. **æµ‹è¯•è¦†ç›–ç‡**
   - ç»´æŒæµ‹è¯•è¦†ç›–ç‡è¦æ±‚
   - æ·»åŠ å…³é”®åŠŸèƒ½çš„æµ‹è¯•
   - å®šæœŸå®¡æŸ¥æµ‹è¯•è´¨é‡

---

éœ€è¦æ›´å¤šå¸®åŠ©è¯·æŸ¥çœ‹:
- [GitHub Actionsæ–‡æ¡£](https://docs.github.com/en/actions)
- [PyInstalleræ–‡æ¡£](https://pyinstaller.readthedocs.io/)
- [UVæ–‡æ¡£](https://docs.astral.sh/uv/) 